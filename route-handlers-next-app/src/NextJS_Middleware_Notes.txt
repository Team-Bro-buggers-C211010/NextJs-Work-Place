=======================================================
ğŸ“˜ Notes on Middleware in Next.js â€“ How It Works & Use Cases
=======================================================

Middleware in Next.js runs **before** a request is completed and allows you to **modify the request/response**, 
**rewrite**, **redirect**, **add headers**, or **authenticate** users.

It's useful for logic that should apply to multiple routes **globally or conditionally**, like:
- Auth checks
- Role-based routing
- Logging
- Header manipulation
- Locale redirection

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”¹ Where to Create Middleware

Create a `middleware.ts` file at the root of your `app/` directory:

```
app/
  middleware.ts
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”¹ Basic Middleware Example

```ts
// app/middleware.ts
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
  console.log("Middleware triggered at:", request.nextUrl.pathname);

  return NextResponse.next(); // continue normally
}
```

ğŸ“ You must export a `middleware()` function.  
It automatically applies to all routes unless filtered using `matcher`.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”¹ Use Case: Redirect If Not Authenticated

```ts
export function middleware(request: NextRequest) {
  const token = request.cookies.get('auth_token')?.value;

  if (!token && request.nextUrl.pathname !== '/login') {
    return NextResponse.redirect(new URL('/login', request.url));
  }

  return NextResponse.next();
}
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”¹ Use Case: Add Custom Header

```ts
export function middleware(request: NextRequest) {
  const response = NextResponse.next();
  response.headers.set('x-powered-by', 'ShovanDev');
  return response;
}
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”¹ Use Case: Rewrite Path

```ts
export function middleware(request: NextRequest) {
  const pathname = request.nextUrl.pathname;

  if (pathname === '/old-route') {
    return NextResponse.rewrite(new URL('/new-route', request.url));
  }

  return NextResponse.next();
}
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”¹ Use Case: Geo Location Redirect (e.g., Vercel)

```ts
export function middleware(request: NextRequest) {
  const country = request.geo?.country;

  if (country === 'BD') {
    return NextResponse.rewrite(new URL('/bd-home', request.url));
  }

  return NextResponse.next();
}
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”¹ Apply to Specific Routes Only (matcher)

In `middleware.ts`, add a `config` export:

```ts
export const config = {
  matcher: ['/dashboard/:path*', '/settings'],
};
```

âœ… This limits middleware to those routes only.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”¸ Summary of What Middleware Can Do

âœ… âœ… âœ… Middleware can:

- âœ… Redirect (e.g., to login)
- âœ… Rewrite paths (e.g., /old â†’ /new)
- âœ… Set headers (e.g., cache-control, custom IDs)
- âœ… Add or modify cookies
- âœ… Perform access control/auth logic
- âœ… Geo-aware redirection
- âœ… Logging, analytics setup

âŒ Middleware cannot:
- Access the response body
- Perform expensive async operations (limited time)
- Access database directly (recommended only in API routes)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“š Summary

âœ… Middleware runs on the Edge (globally)  
âœ… Used for auth, redirects, headers, localization  
âœ… Controlled via `matcher` patterns  
âœ… Use `NextRequest` and `NextResponse` from `next/server`

ğŸ¯ Middleware = centralized control layer for all or selected routes.

